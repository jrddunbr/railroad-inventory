{% extends "base.html" %}
{% block content %}
  <div class="box">
    <h1 class="title is-3">{{ "Edit Placement" if placement else "New Placement" }}</h1>
    <form method="post" action="{{ url_for('main.load_placement_edit', placement_id=placement.id) if placement else (url_for('main.load_placement_new', load_id=load.id) if load else url_for('main.load_placement_new_generic')) }}" data-table="load_placements" data-id="{{ placement.id if placement else '' }}" data-id-field="id">
      <div class="grid">
        {% if load %}
          <div>
            <label>Load</label>
            <p>{{ load.name }}</p>
          </div>
        {% else %}
          <div>
            <label for="load_id">Load</label>
            <select id="load_id" name="load_id" required>
              <option value="">-</option>
              {% for load_item in loads %}
                <option value="{{ load_item.id }}">{{ load_item.name }}</option>
              {% endfor %}
            </select>
          </div>
        {% endif %}
        <div>
          <label for="quantity">Quantity</label>
          <input id="quantity" name="quantity" value="{{ placement.quantity if placement else 1 }}" />
        </div>
        <div>
          <label for="car_id">Car</label>
          <select id="car_id" name="car_id">
            <option value="">-</option>
            {% for car in cars %}
              {% set car_label = (car.railroad.reporting_mark if car.railroad else (car.reporting_mark_override or "")) ~ " " ~ (car.car_number or "") %}
              <option value="{{ car.id }}" {% if preset_car_id and preset_car_id == car.id|string %}selected{% endif %}>{{ car_label.strip() or ("Car " ~ car.id) }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label for="location_id">Location</label>
          <select id="location_id" name="location_id">
            <option value="">-</option>
            {% for location in locations %}
              <option value="{{ location.id }}" {% if preset_location_id and preset_location_id == location.id|string %}selected{% endif %}>{{ location.name }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="actions buttons">
        <button type="submit" class="button is-small is-primary">Save</button>
        {% if load %}
          <a class="button is-small is-light" href="{{ url_for('main.load_detail', load_id=load.id) }}">Cancel</a>
        {% else %}
          <a class="button is-small is-light" href="{{ url_for('main.loads') }}">Cancel</a>
        {% endif %}
      </div>
    </form>
  </div>
{% endblock %}
